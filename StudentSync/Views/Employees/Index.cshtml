@{
    ViewBag.Title = "Datatables";
    ViewBag.pTitle = "Datatables";
    ViewBag.pageTitle = "Tables";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- DataTables CSS -->
<link href="~/assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css" />
<link href="~/assets/libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css" />
<link href="~/assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css" />

<!-- Include necessary CSS -->
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
       
                <button type="button" class="btn btn-primary mb-3" onclick="onAddEmployeeClick()">Add New Employee</button>
                <table id="EmployeeTable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>Gender</th>
                            <th>DoB</th>
                            <th>Qualification</th>
                            <th>Designation</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="employeeTableBody">
                    </tbody>
                </table>

                <!-- Add/Edit Employee Modal -->
                <div class="modal fade" id="addEditEmployeeModal" tabindex="-1" role="dialog" aria-labelledby="addEditEmployeeModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="addEditEmployeeModalLabel">Add/Edit Employee</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form id="employeeForm">
                                    <input type="hidden" id="Id" name="Id" />
                                    <div class="form-group">
                                        <label for="FirstName">First Name:</label>
                                        <input type="text" class="form-control" id="FirstName" placeholder="Enter first name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="LastName">Last Name:</label>
                                        <input type="text" class="form-control" id="LastName" placeholder="Enter last name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="Gender">Gender:</label>
                                        <select class="form-control" id="Gender">
                                            <option value="Male">Male</option>
                                            <option value="Female">Female</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="DoB">Date of Birth:</label>
                                        <input type="date" class="form-control" id="DoB">
                                    </div>
                                    <div class="form-group">
                                        <label for="Qualification">Qualification:</label>
                                        <input type="text" class="form-control" id="Qualification">
                                    </div>
                                    <div class="form-group">
                                        <label for="Designation">Designation:</label>
                                        <input type="text" class="form-control" id="Designation">
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" onclick="saveEmployee()">Save</button>
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Delete Confirmation Modal -->
                <div class="modal fade" id="deleteConfirmationModal" tabindex="-1" role="dialog" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="deleteConfirmationModalLabel">Confirm Delete</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <p>Are you sure you want to delete this employee?</p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-danger" onclick="deleteEmployee()">Delete</button>
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- Bootstrap JS -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

    <!-- Toastr JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>




    <script>
        
        $(document).ready(function () {
            $('#EmployeeTable').DataTable({
                processing: true,
                serverSide: true,
                ajax: {
                    url: '/Employee/GetAll',
                    type: 'GET',
                    data: function (d) {
                        return {
                            draw: d.draw,
                            start: d.start,
                            length: d.length,
                            searchValue: d.search.value,
                            sortColumn: d.columns[d.order[0].column].data,
                            sortColumnDirection: d.order[0].dir
                        };
                    },
                    dataSrc: 'data'
                },
                columns: [
                    { data: 'id' },
                    { data: 'firstName' },
                    { data: 'lastName' },
                    { data: 'gender' },
                    { data: 'doB' },
                    { data: 'qualification' },
                    { data: 'designation' },
                    {
                        data: null,
                        render: function (data, type, row) {
                            return '<button type="button" class="btn btn-info" onclick="editEmployee(' + row.id + ')">Edit</button>' +  
                                '<button type="button" class="btn btn-danger" onclick="confirmDelete(' + row.id + ')">Delete</button>';
                        }
                    }
                ],
                         error: function (xhr, error, thrown) {
                    console.log('Error occurred: ' + error);
                }

            });


            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": false,
                "progressBar": true,
                "positionClass": "toast-bottom-center",
                "preventDuplicates": false,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "5000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
        });

        function loadData() {
            $.ajax({
                url: '/Employee/GetAll',
                type: 'GET',
                success: function (result) {
                    console.log("Data loaded successfully:", result);
                    if (result && result.succeeded) {
                        var html = '';
                        $.each(result.data, function (key, item) {
                            html += '<tr>';
                            html += '<td>' + item.id + '</td>';
                            html += '<td>' + item.firstName + '</td>';
                            html += '<td>' + item.lastName + '</td>';
                            html += '<td>' + item.gender + '</td>';
                            html += '<td>' + item.doB + '</td>';
                            html += '<td>' + item.qualification + '</td>';
                            html += '<td>' + item.designation + '</td>';
                            html += '<td><button type="button" class="btn btn-info mr-2"  onclick="editEmployee(' + item.id + ')">Edit</button> ';
                            html += '<button type="button" class="btn btn-danger" onclick="confirmDelete(' + item.id + ')">Delete</button></td>';
                            html += '</tr>';
                        });
                        $('#employeeTableBody').html(html);

                        // Destroy and reinitialize DataTable
                        $('#EmployeeTable').DataTable().ajax.reload();
                        $('#EmployeeTable').DataTable();
                    } else {
                        var errorMessage = "Failed to load data";
                        if (result && result.messages) {
                            errorMessage += ": " + result.messages.join(", ");
                        }
                        console.error("Data loading failed:", errorMessage);
                        toastr.error(errorMessage);
                    }
                },
                error: function (error) {
                    console.error("Error loading data:", error);
                    toastr.error("Error loading data. Please try again later.");
                }
            });
        }

        function editEmployee(id) {
            $.ajax({
                url: '/Employee/GetById/' + id,
                type: 'GET',
                success: function (result) {
                    console.log("Employee data retrieved:", result);
                    $('#Id').val(result.data.id);
                    $('#FirstName').val(result.data.firstName);
                    $('#LastName').val(result.data.lastName);
                    $('#Gender').val(result.data.gender);
                    $('#DoB').val(result.data.doB ? result.data.doB.slice(0, 10) : '');
                    $('#Qualification').val(result.data.qualification);
                    $('#Designation').val(result.data.designation);

                    $('#addEditEmployeeModal').modal('show');

                    $('#addEditEmployeeModalLabel').text('Edit Employee');
                },
                error: function (errormessage) {
                    console.error("Error retrieving employee:", errormessage.responseText);
                    alert(errormessage.responseText);
                }
            });
        }

        function saveEmployee() {
            var employee = {
                Id: $('#Id').val() ? parseInt($('#Id').val()) : 0,
                FirstName: $('#FirstName').val(),
                LastName: $('#LastName').val(),
                Gender: $('#Gender').val(),
                DoB: $('#DoB').val(),
                Qualification: $('#Qualification').val(),
                Designation: $('#Designation').val()
            };

            var url = employee.Id ? '/Employee/UpdateEmployee' : '/Employee/AddEmployee';

            $.ajax({
                url: url,
                type: 'POST',
                data: JSON.stringify(employee),
                contentType: 'application/json; charset=utf-8',
                success: function (result) {
                    toastr.success(result.message);
                    $('#addEditEmployeeModal').modal('hide');
                    loadData();
                },
                error: function (xhr, status, error) {
                    var errorMessage = xhr.status + ': ' + xhr.statusText;
                    console.error('Error - ' + errorMessage);
                    if (xhr.responseJSON && xhr.responseJSON.message) {
                        console.error('Server error message: ' + xhr.responseJSON.message);
                        toastr.error('Error saving employee: ' + xhr.responseJSON.message);
                    } else {
                        toastr.error('Error saving employee. Please check the console for more details.');
                    }
                }
            });
        }

        function onAddEmployeeClick() {
            $('#Id').val('');
            $('#FirstName').val('');
            $('#LastName').val('');
            $('#Gender').val('Male');
            $('#DoB').val('');
            $('#Qualification').val('');
            $('#Designation').val('');

            $('#addEditEmployeeModal').modal('show');
            $('#addEditEmployeeModalLabel').text('Add New Employee');
        }




        function confirmDelete(id) {
            $('#Id').val(id);
            $('#deleteConfirmationModal').modal('show');
        }

        function deleteEmployee() {
            var id = $('#Id').val();

            $.ajax({
                url: '/Employee/DeleteEmployee/' + id,
                type: 'POST',
                success: function (result) {
                    console.log("Employee deleted successfully:", result);
                    $('#deleteConfirmationModal').modal('hide');
                    toastr.success('Employee deleted successfully.');
                    loadData();
                },
                error: function (errormessage) {
                    console.error("Error deleting employee:", errormessage.responseText);
                    alert(errormessage.responseText);
                }
            });
        }



    </script>
}


@* 
@{
    ViewBag.Title = "Datatables";
    ViewBag.pTitle = "Datatables";
    ViewBag.pageTitle = "Tables";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- DataTables CSS -->
<link href="~/assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css" />
<link href="~/assets/libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css" />
<link href="~/assets/libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css" />

<!-- Include necessary CSS -->
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <button type="button" class="btn btn-primary mb-3" onclick="onAddEmployeeClick()">Add New Employee</button>
                <table id="EmployeeTable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>Gender</th>
                            <th>DoB</th>
                            <th>Qualification</th>
                            <th>Designation</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="employeeTableBody">
                    </tbody>
                </table>

                <!-- Add/Edit Employee Modal -->
                <div class="modal fade" id="addEditEmployeeModal" tabindex="-1" role="dialog" aria-labelledby="addEditEmployeeModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="addEditEmployeeModalLabel">Add/Edit Employee</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form id="employeeForm">
                                    <input type="hidden" id="Id" name="Id" />
                                    <div class="form-group">
                                        <label for="FirstName">First Name:</label>
                                        <input type="text" class="form-control" id="FirstName" placeholder="Enter first name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="LastName">Last Name:</label>
                                        <input type="text" class="form-control" id="LastName" placeholder="Enter last name" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="Gender">Gender:</label>
                                        <select class="form-control" id="Gender">
                                            <option value="Male">Male</option>
                                            <option value="Female">Female</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="DoB">Date of Birth:</label>
                                        <input type="date" class="form-control" id="DoB">
                                    </div>
                                    <div class="form-group">
                                        <label for="Qualification">Qualification:</label>
                                        <input type="text" class="form-control" id="Qualification">
                                    </div>
                                    <div class="form-group">
                                        <label for="Designation">Designation:</label>
                                        <input type="text" class="form-control" id="Designation">
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" onclick="saveEmployee()">Save</button>
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Delete Confirmation Modal -->
                <div class="modal fade" id="deleteConfirmationModal" tabindex="-1" role="dialog" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="deleteConfirmationModalLabel">Confirm Delete</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <p>Are you sure you want to delete this employee?</p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-danger" onclick="deleteEmployee()">Delete</button>
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- Bootstrap JS -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

    <!-- Toastr JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap4.min.js"></script>

    <script>
        $(document).ready(function () {
            $('#EmployeeTable').DataTable({
                processing: true,
                serverSide: true,
                ajax: {
                    url: '/Employee/GetAll',
                    dataSrc: function (json) {
                        if (json && json.succeeded) {
                            return json.data;
                        } else {
                            toastr.error('Failed to load data');
                            return [];
                        }
                    }
                },
                columns: [
                    { data: 'id' },
                    { data: 'firstName' },
                    { data: 'lastName' },
                    { data: 'gender' },
                    { data: 'doB' },
                    { data: 'qualification' },
                    { data: 'designation' },
                    {
                        data: null,
                        render: function (data, type, row) {
                            return '<button type="button" class="btn btn-info" onclick="editEmployee(' + row.id + ')">Edit</button>' +
                                '<button type="button" class="btn btn-danger" onclick="confirmDelete(' + row.id + ')">Delete</button>';
                        }
                    }
                ],
                paging: true, // Enable pagination
                pageLength: 10, // Set default page length
                lengthMenu: [10, 25, 50, 100] // Page length options
            });

            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": false,
                "progressBar": true,
                "positionClass": "toast-bottom-center",
                "preventDuplicates": false,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "5000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };
        });

        function loadData() {
            $('#EmployeeTable').DataTable().ajax.reload();
        }

        function editEmployee(id) {
            $.ajax({
                url: '/Employee/GetById/' + id,
                type: 'GET',
                success: function (result) {
                    var employee = result.data;
                    $('#Id').val(employee.id);
                    $('#FirstName').val(employee.firstName);
                    $('#LastName').val(employee.lastName);
                    $('#Gender').val(employee.gender);
                    $('#DoB').val(employee.doB ? employee.doB.slice(0, 10) : '');
                    $('#Qualification').val(employee.qualification);
                    $('#Designation').val(employee.designation);

                    $('#addEditEmployeeModal').modal('show');
                    $('#addEditEmployeeModalLabel').text('Edit Employee');
                },
                error: function (error) {
                    console.error("Error retrieving employee:", error);
                    toastr.error("Error retrieving employee. Please try again later.");
                }
            });
        }

        function saveEmployee() {
            var employee = {
                Id: $('#Id').val() ? parseInt($('#Id').val()) : 0,
                FirstName: $('#FirstName').val(),
                LastName: $('#LastName').val(),
                Gender: $('#Gender').val(),
                DoB: $('#DoB').val(),
                Qualification: $('#Qualification').val(),
                Designation: $('#Designation').val()
            };

            var url = employee.Id ? '/Employee/UpdateEmployee' : '/Employee/AddEmployee';

            $.ajax({
                url: url,
                type: 'POST',
                data: JSON.stringify(employee),
                contentType: 'application/json; charset=utf-8',
                success: function (result) {
                    toastr.success(result.message);
                    $('#addEditEmployeeModal').modal('hide');
                    loadData();
                },
                error: function (xhr, status, error) {
                    var errorMessage = xhr.status + ': ' + xhr.statusText;
                    console.error('Error - ' + errorMessage);
                    if (xhr.responseJSON && xhr.responseJSON.message) {
                        console.error('Server error message: ' + xhr.responseJSON.message);
                        toastr.error('Error saving employee: ' + xhr.responseJSON.message);
                    } else {
                        toastr.error('Error saving employee. Please check the console for more details.');
                    }
                }
            });
        }

        function onAddEmployeeClick() {
            $('#Id').val('');
            $('#FirstName').val('');
            $('#LastName').val('');
            $('#Gender').val('Male');
            $('#DoB').val('');
            $('#Qualification').val('');
            $('#Designation').val('');

            $('#addEditEmployeeModal').modal('show');
            $('#addEditEmployeeModalLabel').text('Add New Employee');
        }

        function confirmDelete(id) {
            $('#Id').val(id);
            $('#deleteConfirmationModal').modal('show');
        }

        function deleteEmployee() {
            var id = $('#Id').val();

            $.ajax({
                url: '/Employee/DeleteEmployee/' + id,
                type: 'POST',
                success: function (result) {
                    $('#deleteConfirmationModal').modal('hide');
                    toastr.success('Employee deleted successfully.');
                    loadData();
                },
                error: function (error) {
                    console.error("Error deleting employee:", error);
                    toastr.error("Error deleting employee. Please try again later.");
                }
            });
        }
    </script>
} *@

